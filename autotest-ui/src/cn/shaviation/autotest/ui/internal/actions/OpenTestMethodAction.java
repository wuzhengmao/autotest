package cn.shaviation.autotest.ui.internal.actions;

import org.eclipse.core.runtime.CoreException;
import org.eclipse.jdt.core.IJavaProject;
import org.eclipse.jdt.core.IMethod;
import org.eclipse.jdt.ui.JavaUI;
import org.eclipse.jface.action.Action;
import org.eclipse.swt.widgets.Shell;

import cn.shaviation.autotest.core.jdt.AutoTestProjects;
import cn.shaviation.autotest.ui.internal.util.UIUtils;

public class OpenTestMethodAction extends Action {

	private Shell shell;
	private IJavaProject javaProject;
	private String testMethod;

	public OpenTestMethodAction(Shell shell, IJavaProject javaProject,
			String testMethod) {
		super();
		this.shell = shell;
		this.javaProject = javaProject;
		this.testMethod = testMethod;
	}

	public OpenTestMethodAction(String text, Shell shell,
			IJavaProject javaProject, String testMethod) {
		super(text);
		this.shell = shell;
		this.javaProject = javaProject;
		this.testMethod = testMethod;
	}

	@Override
	public void run() {
		IMethod method = AutoTestProjects
				.getTestMethod(javaProject, testMethod);
		if (method != null) {
			try {
				JavaUI.openInEditor(method, true, true);
			} catch (CoreException e) {
				UIUtils.showError(shell, "Error", "Open test method error", e);
			}
		} else {
			UIUtils.showError(
					shell,
					"Cannot Open Editor",
					"Test method \"" + testMethod
							+ "\" not found in project \""
							+ javaProject.getElementName() + "\"");
		}
	}
}
